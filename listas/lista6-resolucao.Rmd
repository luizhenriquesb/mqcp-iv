---
title: "Métodos Quantitativos IV - Lista 6 (resolução)"
subtitle: "Departamento de Ciência Política da FFLCH-USP"
author: 'Luiz Henrique da Silva Batista (Número USP: 12687228)'
date: "2023-11-30"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Essa a lista compreende questões sobre a verificação dos pressupostos do modelo de regressão linear.

```{r}
# Material de apoio para esta lista:
# https://jonnyphillips.github.io/Analise_de_Dados_2022/
```

### Carregando pacotes

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
library(stargazer)
library(vroom)
```

### Exercício 1

Nesta lista, utilizaremos os microdados do ENEM relativos a 2022. Faça o download dos dados do ENEM de 2022 e do dicionário de dados. Leia o dicionário de dados.

```{r}
# Link: https://www.gov.br/inep/pt-br/acesso-a-informacao/dados-abertos/microdados/enem
# Selecione as variáveis NU_NOTA_CH e NU_NOTA_MT
```

Limpe os dados para a análise.

```{r, message=FALSE}
enem_2022 <- vroom::vroom("datasets/microdados_enem_2022/DADOS/MICRODADOS_ENEM_2022.csv",
                          quote = "", delim = ";") |> 
  # Coloca em letras minúsculas os nomes das colunas 
  janitor::clean_names() |> 
  # Seleciona somente as variáveis de interesse
  dplyr::select(nu_inscricao, nu_nota_ch, nu_nota_mt) |> 
  # Removendo NA's
  drop_na(nu_nota_ch, nu_nota_mt)
```

Para a leitura da nossa base de dados utilizamos a função `vroom()`, do pacote `{vroom}`. A motivação se deve ao fato de que a velocidade de leitura dessa função é de 1,23GB/s, tornando-se excelente para importar bases grandes. Para mais informações sobre esse pacote, acesse [este link](https://vroom.r-lib.org/).

### Exercício 2

Utilize a nota do ENEM em ciências humanas para prever a nota em matemática por meio de uma regressão linear simples. Interprete os resultados.

```{r, results='asis'}
reg <- lm(nu_nota_mt ~ nu_nota_ch, data = enem_2022)

stargazer::stargazer(reg,
                     type = "latex",
                     style = "ajps",
                     title = "Regressão linear",
                     single.row = T, 
                     keep.stat = c("n"),
                     dep.var.labels = "Nota em matemática",
                     header = F,
                     dep.var.caption= "")
```

Formalmente, o modelo pode ser representado pela seguinte expressão:

$$
Nota\ em\ matemática = \alpha + \beta \cdot X_{Nota\ em\ ciências\ humanas}
$$

Nosso modelo de regressão estima que a nota de matemática aumenta, em média, cerca de 0.905 pontos para cada 1 (um) ponto a mais obtido na prova de ciências humanas. Além disso, quando a nota em ciências humanas é zero temos uma nota de matemática esperada de 62.975.

### Exercício 3

Calcule os intervalos de confiança dos coeficientes.

|   Intervalo de confiança de 95% para $\alpha$    |   Intervalo de confiança de 95% para $\beta$   |
|:-----------------------------------:|:---------------------------------:|
| (`r 62.975 - 2 * 0.399`; `r 62.975 + 2 * 0.399`) | (`r 0.905 - 2 * 0.001`; `r 0.905 + 2 * 0.001`) |

Por que o R utiliza a distribuição t (e não a distribuição normal) para as inferências?

### Exercício 4

Utilize os resíduos para testar graficamente o seguinte: $E[\hat{e}|X=x]=0$. Explique a sua conclusão.

```{r}
df <- data.frame(residuos = residuals(reg), 
                 preditor = enem_2022$nu_nota_ch)

df |> 
  ggplot(aes(x = preditor, y = residuos)) + 
  geom_point() + 
  geom_smooth(method="lm", se=F) +
  theme_classic()
```

O gráfico acima permite demonstrar que $E[\hat{e}|X=x]=0$. Conforme os resíduos representam a diferença entre a previsão do modelo de regressão $\hat{y_i}$ e o valor observado $y_i$, uma média igual a 0 (zero), condicional a um dado conjunto de valores $X=x$, significa que nosso modelo

Qual é a motivação desse teste? Em outras palavras, qual pressuposto do modelo linear gostaríamos de satistazer?

O objetivo desse teste é satisfazer o pressuposto de que os resíduos devem ter esperança igual a zero, ou seja, que $E[\hat{e}|X=x]=0$.

Qual é a consequência da violação desse pressuposto?

### Exercício 5

Com base nos resíduos, utilize um gráfico para testar a hipótese de homocedasticidade dos erros. Explique a sua conclusão.

Qual é a consequência da violação desse pressuposto?

### Exercício 6

Com base nos resíduos, utilize um gráfico para testar a hipótese de normalidade dos erros. Explique a sua conclusão.

Qual é a consequência da violação desse pressuposto?

### Exercício 7

Apresente seus resultados em um arquivo PDF. Garanta que seu arquivo esteja limpo, contendo as respostas, os gráficos e as tabelas, mas não eventuais mensagens e erros. O arquivo PDF pode ser gerado diretamente a partir do R por meio do RMarkdown ou do RSweave. Para os alunos de graduação, isso é recomendado, mas não obrigatório. Adicionalmente, forneça o script para replicação.
